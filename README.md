# ИДЗ-2. Вариант 7
Исполнитель: Миронов Павел Андреевич. Группа: БПИ-212
## Условие задачи
Есть три процесса–курильщика и один
процесс–посредник. Курильщик непрерывно скручивает сигареты
и курит их. Чтобы скрутить сигарету, нужны табак, бумага и спички. У одного процесса–курильщика есть табак, у второго — бумага, а у третьего — спички. Посредник кладет на стол по два разных случайных компонента. Тот процесс–курильщик, у которого
есть третий компонент, забирает компоненты со стола, скручивает
сигарету и курит. Посредник дожидается, пока курильщик закончит, затем процесс повторяется. Создать приложение, моделирующее поведение курильщиков и посредника. Каждый
курильщик — клиент. Посредник — сервер.

## 4 балла
### Схема работы программы
Множество процессов взаимодействуют с использованием именованных POSIX семафоров.
Обмен данными ведется через разделяемую память в стандарте POSIX.

### Пример результата работы
```
Курильщик номер 1 готов, у него есть табак.
Курильщик номер 2 готов, у него есть табак.
Курильщик номер 3 готов, у него есть табак.
Посредник положил на стол табак и бумагу
Курильщик номер 3 забирает со стола табак и бумагу и скуривает сигарету.
Раунд пройден.
Посредник положил на стол бумагу и спички
Курильщик номер 1 забирает со стола бумагу и спички и скуривает сигарету.
Раунд пройден.
Посредник положил на стол табак и бумагу
Курильщик номер 3 забирает со стола табак и бумагу и скуривает сигарету.
Раунд пройден.
Все раунды завершены.
```

## 5 баллов
### Сценарий работы программы

Процессы взаимодействуют с использованием семафоров в стандарте UNIX SYSTEM V.
Обмен данными ведется через разделяемую память в стандарте UNIX SYSTEM V.

#### Посредник:
1. Создание семафоров и общей разделяемой памяти.
2. Вход в цикл с количеством раундов `n`.
3. Генерация случайного числа `random_number` от 1 до 3.
4. Положение предметов на стол в соответствии с `random_number`.
5. Сигнализация соответствующему курильщику о наличии предметов на столе.
6. Ожидание пока курильщик заберет предметы.
7. Засыпание на 1 секунду.
8. Вывод сообщения о завершении раунда.
9. Уменьшение значения `n` на 1.
10. Повторение шагов с пункта 3, пока `n` не станет равным 0.
11. Завершение работы.

#### Курильщики:
1. Каждый курильщик проверяет значение `num_rounds`, хранящееся в разделяемой памяти.
2. Если значение `num_rounds` меньше или равно 0, курильщик завершает работу.
3. Засыпание на 1 секунду.
4. Ожидание сигнала от посредника о наличии предметов на столе.
5. Вывод сообщения о взятии предметов и курении сигареты.
6. Засыпание на 1 секунду.
7. Уменьшение значения `num_rounds` на 1.
8. Если значение `num_rounds` становится равным 0, курильщик сигнализирует остальным курильщикам о завершении.
9. Сигнализация посреднику о том, что предметы были взяты со стола.
10. Повторение шагов с пункта 2, пока значение `num_rounds` не станет меньше или равно 0.
11. Завершение работы.

### Пример результата работы
```
Курильщик номер 1 готов, у него есть табак.
Курильщик номер 2 готов, у него есть табак.
Курильщик номер 3 готов, у него есть табак.
Посредник положил на стол бумагу и спички
Курильщик номер 1 забирает со стола бумагу и спички и скуривает сигарету.
Раунд пройден.
Посредник положил на стол бумагу и спички
Курильщик номер 1 забирает со стола бумагу и спички и скуривает сигарету.
Раунд пройден.
Посредник положил на стол табак и бумагу
Курильщик номер 3 забирает со стола табак и бумагу и скуривает сигарету.
Раунд пройден.
Посредник положил на стол табак и спички
Курильщик номер 2 забирает со стола табак и спички и скуривает сигарету.
Раунд пройден.
Посредник положил на стол табак и бумагу
Курильщик номер 3 забирает со стола табак и бумагу и скуривает сигарету.
Раунд пройден.
Все раунды завершены.
```


#### P.S.
Для удобства тестирования написан docker-compose файл, который запускает контейнер с рабочим gcc
```
docker-compose up -d
```

Для подключения к контейнеру используйте команду
```
docker compose exec -it server bash
```


Пример запуска программы на 5 баллов, где N - количество раундов программы (по умолчанию 5):
```
cd 5
gcc -o main.o main.c && ./main.o N
```